# TrueWord Node v1.2 发布说明

发布日期：2025-10-06

## 📋 版本概述

TrueWord Node v1.2 是一个功能增强版本，主要改进了策略路由的灵活性和用户体验。本版本引入了策略组优先级自定义功能，并优化了命令行界面的表格显示效果。

## ✨ 新增功能

### 1. 策略组优先级自定义

- **手动指定优先级**：创建策略组时可通过 `--priority` 参数指定优先级（100-899）
- **自动分配优先级**：未指定时自动从 100 开始递增分配
- **优先级冲突检测**：创建和调整优先级时自动检测并提示冲突
- **智能优先级推荐**：自动寻找下一个可用优先级

**使用示例**：
```bash
# 手动指定优先级
twnode policy create --priority 150 --cidr 192.168.1.0/24 --exit tun01 group1

# 自动分配优先级
twnode policy create --cidr 10.0.0.0/8 --exit tun02 group2
```

### 2. 优先级调整命令

新增 `policy set-priority` 命令，支持动态调整已创建策略组的优先级：

- **范围验证**：确保优先级在有效范围内（100-899）
- **冲突检测**：防止与其他策略组优先级冲突
- **自动重新应用**：如果策略组已应用，调整后自动重新应用规则

**使用示例**：
```bash
twnode policy set-priority group1 200
```

### 3. 优化的策略列表显示

- **表格化展示**：使用 tablewriter 库实现美观的表格输出
- **完美对齐**：正确处理中英文混合字符的宽度对齐
- **按优先级排序**：列表自动按优先级从高到低排序（数字小优先级高）
- **清晰的列信息**：组名、优先级、出口、CIDR数量、源限制一目了然

**输出示例**：
```
╔════════╦════════╦════════╦══════════╦══════════╗
║  组名  ║ 优先级 ║  出口  ║ CIDR数量 ║  源限制  ║
╠════════╬════════╬════════╬══════════╬══════════╣
║ group1 ║  100   ║ tun01  ║    2     ║          ║
║ group2 ║  150   ║ tun02  ║    1     ║          ║
╚════════╩════════╩════════╩══════════╩══════════╝
```

## 🔧 改进优化

### 代码质量提升

- **依赖管理**：引入 `github.com/olekukonko/tablewriter` 库处理表格显示
- **错误处理**：增强优先级验证和冲突检测的错误提示
- **用户体验**：提供更清晰的命令行交互和错误信息

### 性能优化

- **静态编译**：所有发布版本均为静态链接，无外部依赖
- **二进制优化**：使用 `-ldflags="-s -w"` 减小二进制文件体积
- **跨平台支持**：提供 x86_64 和 ARM 平台的预编译二进制文件

## 📦 发布文件

本版本提供以下平台的静态编译二进制文件：

- `twnode-v1.2-linux-amd64`：适用于 x86_64 架构 Linux 系统
- `twnode-v1.2-linux-arm64`：适用于 ARM64 架构 Linux 系统
- `twnode-v1.2-linux-armv7`：适用于 ARMv7 架构 Linux 系统（如树莓派）

所有二进制文件均为静态链接，无需安装任何运行时依赖。

## 🔄 升级说明

### 从 v1.1 升级

1. **备份现有配置**：
   ```bash
   sudo cp -r /etc/trueword_node /etc/trueword_node.backup
   ```

2. **下载新版本二进制**：
   选择适合您系统架构的二进制文件

3. **替换旧版本**：
   ```bash
   sudo cp twnode-v1.2-linux-amd64 /usr/local/bin/twnode
   sudo chmod +x /usr/local/bin/twnode
   ```

4. **验证版本**：
   ```bash
   twnode version
   # 应显示: TrueWord Node v1.2
   ```

5. **配置兼容性**：
   v1.2 完全兼容 v1.1 的配置文件，无需修改现有配置

### 新用户安装

请参考项目 README.md 中的安装说明。

## 📖 完整更新列表

- **新增**：策略组创建时 `--priority` 参数支持
- **新增**：`policy set-priority` 命令
- **新增**：优先级冲突自动检测机制
- **改进**：`policy list` 命令表格化显示
- **改进**：策略组按优先级排序展示
- **优化**：中英文混合文本对齐显示
- **优化**：静态编译配置，消除运行时依赖
- **文档**：更新 CLAUDE.md 开发文档

## 🐛 已知问题

无已知严重问题。

## 🔮 下一步计划

- 支持 IPv6 隧道和策略路由
- 添加策略路由模板功能
- 实现策略组的导入/导出
- Web UI 管理界面（计划中）

## 📞 反馈与支持

如遇到问题或有功能建议，欢迎通过以下方式反馈：

- GitHub Issues（如项目开源）
- 项目文档和社区

## 🙏 致谢

感谢所有使用 TrueWord Node 的用户，您的反馈帮助我们不断改进！

---

**完整更新日志**：请查看 git tag v1.2 的注释信息
